function getQueryString(o){let e=new RegExp("(^|&)"+o+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(e);return null!=n?unescape(n[2]):null}const preUrl="http://119.23.136.26:7009";window.onload=function(){function o(){const o=io(preUrl+"/led");o.on("connect",function(){console.log("建立socket连接"),console.log(o.id),o.emit("client_message",{my:"data"}),o.on("server_message",function(o){console.log("服务端消息"),console.log(o);const{index:e}=o;"activity"===e&&(setTimeout(()=>{$(".number_three").addClass("show_number animated zoomIn")},1e3),setTimeout(()=>{$(".number_three").removeClass("show_number animated zoomIn"),$(".number_two").addClass("show_number animated zoomIn")},2e3),setTimeout(()=>{$(".number_two").removeClass("show_number animated zoomIn"),$(".number_one").addClass("show_number animated zoomIn")},3e3),setTimeout(()=>{$(".number_one").removeClass("show_number animated zoomIn");const o=localStorage.getItem("openId");window.location.href=`${location.origin}/join.html?openid=${o}`},4e3))})})}function e(e){const n=`${preUrl}/api/user/join`,t=weui.loading("报名...",{className:"content"});$.post(n,e,function(e){t.hide(),console.log("报名"),console.log(e);const{state:n,msg:s}=e;weui.toast(s,2e3),o()})}const n=encodeURIComponent(location.origin),t=getQueryString("code");if(console.log("微信code"),console.log(t),t){const o=`${preUrl}/api/wx/openid?code=${t}`;$.get(o,function(o){console.log("获取openId"),console.log(o);const{data:n,state:t}=o;if(1e3===t){const{openid:o}=n;localStorage.setItem("openId",o);e({openId:o})}})}$(".join-button").on("click",function(){console.log("报名参加");const o=localStorage.getItem("openId");if(void 0===o||null===o)console.log("未获取公众号openId"),console.log("先获取微信code"),window.location.href=`https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx1a1d4735f92e3696&redirect_uri=${n}&response_type=code&scope=snsapi_userinfo#wechat_redirect`;else{console.log("已获取公众号openId，报名");e({openId:o})}})};