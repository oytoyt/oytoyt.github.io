function getQueryString(e){let o=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),t=window.location.search.substr(1).match(o);return null!=t?unescape(t[2]):null}const preUrl="http://119.23.136.26:7009";window.onload=function(){function e(){const e=io(preUrl+"/console");e.on("connect",function(){console.log("建立socket连接"),console.log(e.id),e.emit("console_message",{my:"console_message"}),e.on("server_message",function(e){console.log("服务端消息"),console.log(e);const{state:o,data:t,index:s}=e;if("reward"===s)return function(e={}){console.log("调用了"),Object.keys(e).forEach(function(o){console.log("调用了",r(e[o].times)),$(`img.user[data-openid=${o}]`).css("transform",`translateY(${r(e[o].times)})`)})}(t.members);if(1e3===o){const{count:e,list:o}=t;e>=c&&(u=!0),n(o)}})})}function o(){const e=`${preUrl}/api/activity/lottery`,o=weui.loading("抽奖...",{className:"content"});$.get(e,function(e){o.hide(),console.log("请求抽奖"),console.log(e);const{state:t,msg:s,data:n}=e;1e3===t&&function(e){e.forEach((e,o)=>{const{headimgurl:t,nickname:s}=e;let{id:n}=e;n=""+n;const a=`.winner_img${o}`;$(a).attr("src",t),$(".lottery_user").forEach(e=>{const o=$(e).attr("data-id");n===o&&$(e).removeClass("user_show")}),0===o?$(".winner_second").html(s):1===o?$(".winner_first").html(s):2===o&&$(".winner_third").html(s)}),$(".winner_pannel").addClass("show animated zoomInUp"),$(".winner_info_pannel").addClass("show animated zoomIn"),$(".water-full").addClass("show animated fadeIn slower"),l.play()}(n)})}function t(){setTimeout(()=>{if($(".count_down").removeClass("animated zoomIn"),$(".count_down").addClass("animated zoomIn"),1===_)return $(".activity_user_list.test img").css("transform","translateY(0)"),$(".lottery_activity_user_list:not(.test)").removeClass("user_step"),$(".lottery_activity_user_list:not(.test)").addClass("user_list_water_full"),$(".water-10").removeClass("water-step"),$(".water-10").addClass("water_full"),$(".count_down").removeClass("animated zoomIn"),$(".count_down").html(""),_=w,void o();19===_&&($(".water-10").addClass("water-step"),$(".lottery_activity_user_list:not(.test)").addClass("user_step"),$(".lottery_activity_user_list.test").addClass("testStop")),t()},1e3),_-=1}function s(){const e=`${preUrl}/api/activity/start`;$.get(e,function(e){console.log("请求开始活动"),console.log(e);const{state:o}=e;1e3===o&&($(".content").addClass("hide"),$(".lottery").addClass("show"),m&&$(".lotter-button").addClass("hide"),function(e){setTimeout(()=>{$(".number_three").addClass("show_number animated zoomIn")},1e3),setTimeout(()=>{$(".number_three").removeClass("show_number animated zoomIn"),$(".number_two").addClass("show_number animated zoomIn")},2e3),setTimeout(()=>{$(".number_two").removeClass("show_number animated zoomIn"),$(".number_one").addClass("show_number animated zoomIn")},3e3),setTimeout(()=>{$(".number_one").removeClass("show_number animated zoomIn"),e()},4e3)}(()=>{t()}))})}function n(e){console.log("显示报名的用户");let o=0;e.length>1&&(o=e.length-1),e.forEach((e,t)=>{const{headimgurl:s,id:n,openid:a}=e,r=`.join_user${t}`,l=`.lottery_user${t}`,i=`.action_user${t}`;$(r).attr("src",s),$(l).attr("src",s),$(l).attr("data-id",`${n}`),$(l).attr("data-openid",`${a}`);"none"===$(r).css("display")&&($(l).addClass("user_show"),t===o&&($(i).attr("src",s),$(i).addClass("show water-down")),setTimeout(()=>{$(i).removeClass("show water-down"),$(r).addClass("user_show animated zoomIn")},2400),setTimeout(()=>{$(r).removeClass("animated zoomIn")},5e3))})}function a(e){let o="初始化游戏...",t="lottery";0===e&&(o="清空浴缸...",t="content");const s=weui.loading(o,{className:t}),n=`${preUrl}/api/activity/end`;$.post(n,function(e){s.hide(),console.log("结束本轮活动"),console.log(e);const{state:o}=e;1e3===o&&function(){console.log("继续游戏"),u=!1,_=w,$(".content").removeClass("hide"),$(".lottery").removeClass("show");Array.from(new Array(20).keys()).forEach((e,o)=>{const t=`.join_user${o}`,s=`.lottery_user${o}`;$(t).attr("src","source/logo.jpg"),$(s).attr("src","source/logo.jpg"),$(s).attr("data-id","-1"),$(t).removeClass("animated zoomIn"),$(s).removeClass("animated zoomIn"),$(t).removeClass("user_show"),$(s).removeClass("user_show")}),$(".action_user").removeClass("show water-down"),$(".water-10").removeClass("show animated fadeIn slower"),$(".water-20").removeClass("show animated fadeIn slower"),$(".water-30").removeClass("show animated fadeIn slower"),$(".water-40").removeClass("show animated fadeIn slower"),$(".water-50").removeClass("show animated fadeIn slower"),$(".water-60").removeClass("show animated fadeIn slower"),$(".water-70").removeClass("show animated fadeIn slower"),$(".water-80").removeClass("show animated fadeIn slower"),$(".water-90").removeClass("show animated fadeIn slower"),$(".water-100").removeClass("show animated fadeIn slower"),$(".water-full").removeClass("show animated fadeIn slower"),$(".lottery_activity_user_list").removeClass("user_list_water_full"),$(".water-10").removeClass("water_full"),$(".winner_pannel").removeClass("show animated zoomInUp"),$(".winner_info_pannel").removeClass("show animated zoomIn"),$(".number_one").removeClass("show_number animated zoomIn"),$(".number_two").removeClass("show_number animated zoomIn"),$(".number_three").removeClass("show_number animated zoomIn"),$(".lotter-button").removeClass("hide"),$(".join-button").removeClass("hide"),u=!1}()})}function r(e){return(e=e>=60?60:e)/60*-500+"%"}const l=new Audio("source/win.mp3"),i=new Audio("source/bgm.mp3");window.addEventListener("click",function(){const e=$("#hint-title").css("display");console.log(e),i.loop=!0,i.play(),console.log("背景音乐")},!1);const c=3;let m=!0,d=!1,u=!1;const w=20;parseInt(1*w),parseInt(.9*w),parseInt(.8*w),parseInt(.7*w),parseInt(.6*w),parseInt(.5*w),parseInt(.4*w),parseInt(.3*w),parseInt(.2*w);let _=w;$(".fullScreen").on("click",function(){let e=document.documentElement,o=e.requestFullScreen||e.webkitRequestFullScreen||e.mozRequestFullScreen||e.msRequestFullscreen;void 0!==o&&o&&o.call(e)}),$(".exitScreen").on("click",function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),"undefined"!=typeof cfs&&cfs&&cfs.call(el)}),$(".content-restart").on("click",function(){a(0)}),$(".restart").on("click",function(){a()}),$(".join-button").on("click",function(){console.log("点击开始活动"),!0===u?($(".join-button").addClass("hide"),s()):weui.toast(`未满 ${c} 人`,1500)}),$(".lotter-button").on("click",function(){console.log("活动计时中"),$(".lotter-button").addClass("hide"),t()}),setTimeout(e,1e3),function(){const e=`${preUrl}/api/user/list`;!0===u&&!0===d||$.get(e,function(e){console.log("报名的人"),console.log(e);const{state:o,data:t}=e;if(1e3===o){const{count:e,list:o}=t;e>=c&&(u=!0),n(o)}})}()};